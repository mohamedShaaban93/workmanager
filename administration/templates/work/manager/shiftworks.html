{% extends 'base.html' %}

{% block content %}
<div class="alert-danger alert-dismissible fade show text-center h4" role="alert" id="diverror" >
</div>
<hr>
<table class="table  text.center ">
    <tr class=" from-control bg-success">
            <th class="table-warning">Employee</th>
            {% if type == 1 %}
            <th>6 AM</th>
            <th>7 AM</th>
            <th>8 AM</th>
            <th>9 AM</th>
            <th>10 AM</th>
            <th>11 AM</th>
            <th>12 PM</th>
            <th>1 PM</th>
            {% elif type == 2 %}
                <th>2 PM</th>
                <th>3 PM</th>
                <th>4 PM</th>
                <th>5 PM</th>
                <th>6 PM</th>
                <th>7 PM</th>
                <th>8 PM</th>
                <th>9 PM</th>
            {% else %}
                <th>10 PM</th>
                <th>11 PM</th>
                <th>12 AM</th>
                <th>1 AM</th>
                <th>2 AM</th>
                <th>3 AM</th>
                <th>4 AM</th>
                <th>5 AM</th>
            {% endif %}
        </tr>
        {% for ele in data %}
            <tr class="text-center form from-control  ">
                <td class="bg-info">{{ele.shift.employee}}</td>

                <!--                one      -->
                {% if ele.workhour.one == True %}
                <td class="bg-danger" >
                    <select class="btn btn-danger">
                 {% else %}
                <td class="bg-success" >
                    <select class="btn btn-success">
                 {% endif %}
                        <option value="1-1-{{ele.workhour.pk}}" {% if ele.workhour.one == True %}selected{% endif%}>ON</option>
                        <option value="1-0-{{ele.workhour.pk}}" {% if ele.workhour.one == False %}selected{% endif%}>OFF</option>
                    </select>
                </td>

                                <!--                two      -->

                {% if ele.workhour.two == True %}
                <td class="bg-danger" >
                    <select class=" btn-danger">
                 {% else %}
                <td class="bg-success" >
                    <select class=" btn-success">
                 {% endif %}
                        <option value="2-1-{{ele.workhour.pk}}" {% if ele.workhour.two == True %}selected{% endif%}>ON</option>
                        <option value="2-0-{{ele.workhour.pk}}" {% if ele.workhour.two == False %}selected{% endif%}>OFF</option>
                    </select>
                </td>

                                <!--                three      -->
                {% if ele.workhour.three == True %}
                <td class="bg-danger" >
                    <select class=" btn-danger">
                 {% else %}
                <td class="bg-success" >
                    <select class=" btn-success">
                 {% endif %}
                        <option value="3-1-{{ele.workhour.pk}}" {% if ele.workhour.three == True %}selected{% endif%}>ON</option>
                        <option value="3-0-{{ele.workhour.pk}}" {% if ele.workhour.three == False %}selected{% endif%}>OFF</option>
                    </select>
                </td>

                                <!--                four      -->

                {% if ele.workhour.four == True %}
                <td class="bg-danger" >
                    <select class=" btn-danger">
                 {% else %}
                <td class="bg-success" >
                    <select class=" btn-success">
                 {% endif %}
                        <option value="4-1-{{ele.workhour.pk}}" {% if ele.workhour.four == True %}selected{% endif%}>ON</option>
                        <option value="4-0-{{ele.workhour.pk}}" {% if ele.workhour.four == False %}selected{% endif%}>OFF</option>
                    </select>
                </td>


                                <!--                five      -->

                {% if ele.workhour.five == True %}
                <td class="bg-danger" >
                    <select class=" btn-danger">
                 {% else %}
                <td class="bg-success" >
                    <select class=" btn-success">
                 {% endif %}
                        <option value="5-1-{{ele.workhour.pk}}" {% if ele.workhour.five == True %}selected{% endif%}>ON</option>
                        <option value="5-0-{{ele.workhour.pk}}" {% if ele.workhour.five == False %}selected{% endif%}>OFF</option>
                    </select>
                </td>

                                <!--                six      -->

                {% if ele.workhour.six == True %}
                <td class="bg-danger" >
                    <select class=" btn-danger">
                 {% else %}
                <td class="bg-success" >
                    <select class=" btn-success">
                 {% endif %}
                        <option value="6-1-{{ele.workhour.pk}}" {% if ele.workhour.six == True %}selected{% endif%}>ON</option>
                        <option value="6-0-{{ele.workhour.pk}}" {% if ele.workhour.six == False %}selected{% endif%}>OFF</option>
                    </select>
                </td>

                                <!--                seven      -->

                {% if ele.workhour.seven == True %}
                <td class="bg-danger" >
                    <select class=" btn-danger">
                 {% else %}
                <td class="bg-success" >
                    <select class=" btn-success">
                 {% endif %}
                        <option value="7-1-{{ele.workhour.pk}}" {% if ele.workhour.seven == True %}selected{% endif%}>ON</option>
                        <option value="7-0-{{ele.workhour.pk}}" {% if ele.workhour.seven == False %}selected{% endif%}>OFF</option>
                    </select>
                </td>


                                <!--                eight      -->

                {% if ele.workhour.eight == True %}
                <td class="bg-danger" >
                    <select class=" btn-danger">
                 {% else %}
                <td class="bg-success" >
                    <select class=" btn-success">
                 {% endif %}
                        <option value="8-1-{{ele.workhour.pk}}" {% if ele.workhour.eight == True %}selected{% endif%}>ON</option>
                        <option value="8-0-{{ele.workhour.pk}}" {% if ele.workhour.eight == False %}selected{% endif%}>OFF</option>
                    </select>
                </td>


            </tr>
        {% endfor %}
</table>
     <hr>
<a class="btn btn-primary text-center form-control h3" href="{%url 'manager:home' %}" xmlns="http://www.w3.org/1999/html"> Back To Home</a>


 <script type="text/javascript">
            let errorcatch =document.getElementById("diverror")
            let table = document.getElementsByTagName("table")[0],
            ajax = new XMLHttpRequest();

            table.onclick = function (event) {
            if (event.target.tagName == "SELECT") {
                console.log(event.target.value)
                num=event.target.value.split('-')
                ajax.open("GET", "http://localhost:8000/manager/WorkHourManage/" + num[0] +"/"+num[1]+"/"+num[2]);
                ajax.setRequestHeader("Access-Control-Allow-Origin", "*");
                ajax.send();
                ajax.onreadystatechange = () => {
                        if (ajax.readyState === 4 && ajax.status === 200) {
                        response = JSON.parse(ajax.responseText);
                        console.log(response);
                        if (response.success) {
                            if(num[1] == '1'){
                                event.target.classList= " btn-danger";
                                event.target.parentElement.classList = 'bg-danger'
                            }else if(num[1] == '0'){
                                event.target.classList= " btn-success";
                                event.target.parentElement.classList = 'bg-success'
                            }
                          }
                           else {
                              event.target.children[1].setAttribute("selected","")
                             errorcatch.innerHTML = "Sorry , the Max number of break hours is 2 ";

                        }
                    }
                   }
                }
            }


    </script>
{% endblock %}